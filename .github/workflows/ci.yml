name: GitHub CI

on: workflow_dispatch

jobs:
  generate-jobs:
    name: Generate  Jobs
    runs-on: ubuntu-latest
    outputs:
      strategy: ${{ steps.generate-jobs.outputs.strategy }}
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-node@v1
        with:
          node-version: 14
      - id: install-dependencies
        name: Install Dependencies
        run: npm install
        working-directory: ./lib
      - id: generate-jobs
        name: Generate Jobs
        run: echo "::set-output name=strategy::{\"matrix\":{\"include\":[$(npm run versions)]}}"
        working-directory: ./lib

  build:
    needs: generate-jobs
    strategy: ${{ fromJson(needs.generate-jobs.outputs.strategy) }}
    name: "${{ matrix.version }}-php-${{ matrix.php.version }}-${{ matrix.php.variant }}"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - id: build
        name: Build
        run: echo "Hello, World"
      - id: images
        name: Images
        run: echo "Hello, World"